==============================================================================
                    PORKCHOP RPG LEVELING SYSTEM - IMPLEMENTATION PLAN
==============================================================================

Created: 2024-12-09
Status: IN PROGRESS

--[ PHASE 1: Core XP Engine ]------------------------------------------------

Files to create:
  - src/core/xp.h
  - src/core/xp.cpp

Features:
  [x] PorkXP struct definition (40 bytes NVS storage)
  [ ] XP::init() - Load from NVS on boot
  [ ] XP::save() - Persist to NVS
  [ ] XP::addXP(amount, reason) - Add XP with event type
  [ ] XP::getLevel() - Calculate level from totalXP
  [ ] XP::getXPForNextLevel() - XP needed for next level
  [ ] XP::getProgress() - 0-100% progress to next level
  [ ] XP::getTitle() - Get current rank title string
  [ ] XP::unlockAchievement(ach) - Set achievement bit
  [ ] XP::hasAchievement(ach) - Check achievement bit
  [ ] Level-up detection and callback

Constants to define:
  - 40 rank titles (SCRIPT PIGGY -> LEGENDARY PORKCHOP)
  - XP formula function
  - Achievement enum (16 achievements)
  - XP values for each event type

NVS keys:
  - "porkxp" namespace
  - Keys: totalxp, achievements, networks, hs, deauths, distance, ble, 
          firstboot, sessions, level

--[ PHASE 2: UI Layout Adjustment ]------------------------------------------

NO CHANGES NEEDED!

Current layout analysis:
  - MAIN_H = 107px
  - Pig face: y=5 to y=71 (3 lines × 22px at textSize=3)
  - Grass: y=73 to y=89 (textSize=2 = ~16px)
  - Empty space: y=89 to y=107 = 18px UNUSED
  
The XP bar fits perfectly in the existing empty space below the grass.
No need to shift pig, bubble, or grass positions.

--[ PHASE 3: XP Bar Display ]------------------------------------------------

Files to modify:
  - src/ui/display.cpp
  - src/ui/display.h (optional: add drawXPBar helper)

Changes:
  [ ] Add XP::drawBar(canvas) call AFTER Avatar::draw() in update()
  [ ] XP bar format: "LV## TITLE  ████████░░ ##%"
  [ ] Bar positioned at y=91, full width, textSize=1 (~12px height)
  [ ] Use COLOR_FG for text, hollow/filled rectangles for progress bar
  [ ] Fits in existing 18px empty space below grass (y=89 to y=107)

--[ PHASE 4: XP Event Hooks ]------------------------------------------------

Files to modify:
  - src/piglet/mood.cpp

Hook XP::addXP() calls into existing event functions:

  [ ] onHandshakeCaptured()     -> +50 XP (HANDSHAKE)
  [ ] onNewNetwork()            -> +1 XP (NETWORK), +5 if hidden, +10 if WPA3
  [ ] onDeauthSuccess()         -> +15 XP (DEAUTH_SUCCESS)
  [ ] onDeauthing()             -> +2 XP per burst (DEAUTH)
  [ ] onWarhogFound()           -> +2 XP (WARHOG_LOG)
  [ ] onPiggyBluesUpdate()      -> +1 XP per burst (BLE_SPAM)
  [ ] onGPSFix()                -> +10 XP first time (GPS_LOCK)
  [ ] onMLPrediction() (rogue)  -> +25 XP (ML_DETECT)

Session bonuses (in porkchop.cpp or xp.cpp):
  [ ] 30 min session            -> +50 XP
  [ ] 60 min session            -> +100 XP
  [ ] 120 min session           -> +200 XP

--[ PHASE 5: Level Up Popup ]------------------------------------------------

Files to modify:
  - src/ui/display.cpp
  - src/core/xp.cpp

Features:
  [ ] XP::onLevelUp callback triggers popup
  [ ] Display::showLevelUp(oldLevel, newLevel, title)
  [ ] Pink filled box with black text (matches showToast style)
  [ ] Shows: "* LEVEL UP! *", "LV X -> LV Y", "RANK_TITLE"
  [ ] Random phrase from LEVELUP_PHRASES[]
  [ ] Auto-dismiss after 2 seconds or on key press
  [ ] Optional: celebratory beep sequence

--[ PHASE 6: Achievement Tracking ]------------------------------------------

Files to modify:
  - src/core/xp.cpp
  - src/piglet/mood.cpp

Achievement checks (in relevant event handlers):
  [ ] ACH_FIRST_BLOOD     - First handshake (onHandshakeCaptured, hsCount==1)
  [ ] ACH_CENTURION       - 100 networks in session (track in OINK/WARHOG)
  [ ] ACH_MARATHON_PIG    - 10km in one session (WARHOG distance)
  [ ] ACH_NIGHT_OWL       - Session after midnight (check GPS time or RTC)
  [ ] ACH_GHOST_HUNTER    - 10 hidden networks lifetime
  [ ] ACH_APPLE_FARMER    - 100 Apple BLE hits
  [ ] ACH_WARDRIVER       - 1000 lifetime networks
  [ ] ACH_DEAUTH_KING     - 100 successful deauths
  [ ] ACH_CHAOS_AGENT     - 1000 BLE packets

Achievement unlock notification:
  [ ] Display::showAchievement(name) - Brief toast

--[ PHASE 7: Stats Integration ]---------------------------------------------

Files to modify:
  - src/core/xp.cpp
  - src/modes/warhog.cpp

Distance tracking:
  [ ] Haversine formula in warhog.cpp
  [ ] Accumulate GPS deltas (filter jitter <5m, jumps >1km)
  [ ] Call XP::addDistance(meters) periodically
  [ ] Award +25 XP per km walked

Lifetime counters (increment in XP::addXP based on event type):
  [ ] lifetimeNetworks
  [ ] lifetimeHS
  [ ] lifetimeDeauths
  [ ] lifetimeBLE
  [ ] lifetimeDistance

--[ PHASE 8: Documentation ]-------------------------------------------------

Files to modify:
  - .github/copilot-instructions.md
  - README.md

Add documentation:
  [ ] XP system overview in copilot-instructions.md
  [ ] Rank table in README.md
  [ ] Achievement list in README.md

==============================================================================
                              XP VALUES REFERENCE
==============================================================================

Event                   | XP    | Trigger
------------------------|-------|------------------------------------------
Network discovered      | +1    | onNewNetwork (first BSSID)
Hidden network          | +5    | onNewNetwork (is_hidden)
WPA3 network            | +10   | onNewNetwork (has_wpa3)
Open network            | +3    | onNewNetwork (is_open)
Handshake captured      | +50   | onHandshakeCaptured
PMKID captured          | +75   | onHandshakeCaptured (pmkid flag)
Deauth burst            | +2    | onDeauthing
Client yeeted           | +15   | onDeauthSuccess
WARHOG network logged   | +2    | onWarhogFound
1 km walked             | +25   | distance threshold
BLE burst               | +1    | onPiggyBluesUpdate
Apple device hit        | +3    | onPiggyBluesUpdate (vendor=Apple)
GPS lock acquired       | +10   | onGPSFix (first time per session)
ML rogue detected       | +25   | onMLPrediction (rogue_ap)
Session 30 min          | +50   | time threshold
Session 60 min          | +100  | time threshold
Session 120 min         | +200  | time threshold
Low battery capture     | +20   | handshake + battery <20%

==============================================================================
                              RANK TITLES (40 LEVELS)
==============================================================================

LV  | Title                 | XP Required | Cumulative
----|----------------------|-------------|------------
1   | SCRIPT PIGGY         | 0           | 0
2   | MUD SNORTER          | 100         | 100
3   | PACKET PIGLET        | 200         | 300
4   | NOOB ROOTER          | 300         | 600
5   | SLOP BUCKET HACKER   | 400         | 1000
6   | TRUFFLE SNIFFER      | 500         | 1500
7   | BACON APPRENTICE     | 800         | 2300
8   | CHANNEL HOPPER       | 1100        | 3400
9   | DEAUTH DABBLER       | 1400        | 4800
10  | HAM HANDED HACKER    | 1700        | 6500
11  | HANDSHAKE HUNTER     | 2000        | 8500
12  | ROGUE ROOTER         | 2500        | 11000
13  | PROMISCUOUS PORKER   | 3000        | 14000
14  | WARDRIVE WANDERER    | 3500        | 17500
15  | PCAP COLLECTOR       | 4000        | 21500
16  | EAPOL EVANGELIST     | 4500        | 26000
17  | FRAME INJECTOR       | 5000        | 31000
18  | SNOUT ZERO DAY       | 5500        | 36500
19  | PORK PROTOCOL        | 6000        | 42500
20  | EVIL TWIN FARMER     | 6500        | 49000
21  | SILICON SWINE        | 7000        | 56000
22  | CHAOS SAUSAGE        | 8000        | 64000
23  | BLACKHAT BOAR        | 9000        | 73000
24  | 802.11 WARLORD       | 10000       | 83000
25  | ALPHA ROOTER         | 11000       | 94000
26  | KERNEL BACON         | 12000       | 106000
27  | NATION STATE SWINE   | 14000       | 120000
28  | ZERO CLICK HOG       | 16000       | 136000
29  | PWNED PORK SUPREME   | 18000       | 154000
30  | SHADOW BROKER BOAR   | 20000       | 174000
31  | MYTHIC MUD DWELLER   | 23000       | 197000
32  | ETERNAL OINK         | 26000       | 223000
33  | VOID SNORTER         | 29000       | 252000
34  | QUANTUM PIGLET       | 32000       | 284000
35  | ASTRAL ROOTER        | 35000       | 319000
36  | ELDER HOG            | 40000       | 359000
37  | PRIME PORCINE        | 45000       | 404000
38  | THE GREAT BOAR       | 50000       | 454000
39  | OMEGA SWINE          | 60000       | 514000
40  | LEGENDARY PORKCHOP   | 86000       | 600000

==============================================================================
                              IMPLEMENTATION PROGRESS
==============================================================================

Phase 1: Core XP Engine         [x] COMPLETE - xp.h/xp.cpp created
Phase 2: UI Layout Adjustment   [x] COMPLETE - No changes needed (fits in empty space)
Phase 3: XP Bar Display         [x] COMPLETE - drawXPBar() at y=91
Phase 4: XP Event Hooks         [x] COMPLETE - All Mood handlers trigger XP
Phase 5: Level Up Popup         [x] COMPLETE - showLevelUpPopup() with callback
Phase 6: Distance Tracking      [x] COMPLETE - Haversine formula in warhog.cpp
Phase 7: Documentation          [x] COMPLETE - copilot-instructions.md updated

All phases complete! Build RAM: 18.6%, Flash: 42.5%

==[EOF]==
